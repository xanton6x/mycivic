<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×“×¨×’×• ××ª ×”-Civic ×©×œ×™</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #1c1e21;
            --sub-text: #65676b;
            --border-color: #ddd;
            --input-bg: #fff;
        }

        [data-theme="dark"] {
            --bg-color: #18191a;
            --card-bg: #242526;
            --text-color: #e4e6eb;
            --sub-text: #b0b3b8;
            --border-color: #3e4042;
            --input-bg: #3a3b3c;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg-color); 
            text-align: center; 
            padding: 20px; 
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .container { 
            max-width: 600px; 
            margin: auto; 
            background: var(--card-bg); 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
        }

        img { width: 100%; border-radius: 15px; margin-bottom: 20px; object-fit: cover; max-height: 400px; }
        
        .stats-box { background: var(--bg-color); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border-color); }
        .average-score { font-size: 2.5rem; font-weight: bold; color: #f39c12; margin: 0; }
        .total-reviews { font-size: 0.9rem; color: var(--sub-text); }

        .rating-input { margin: 20px 0; background: var(--card-bg); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); }
        
        select, textarea { 
            width: 100%; padding: 12px; margin-top: 10px; 
            border: 1px solid var(--border-color); 
            border-radius: 8px; box-sizing: border-box; 
            font-size: 16px; background: var(--input-bg); color: var(--text-color);
        }
        
        button { background: #1877f2; color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; margin-top: 15px; font-weight: bold; width: 100%; transition: background 0.3s; }
        button:hover { background: #166fe5; }

        .theme-toggle {
            position: fixed; top: 20px; left: 20px; background: #1877f2; color: white; border: none;
            padding: 10px; border-radius: 50%; cursor: pointer; width: 45px; height: 45px;
            font-size: 20px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 1000;
        }

        #reviews { margin-top: 30px; text-align: right; }
        .review-card { border-bottom: 1px solid var(--border-color); padding: 15px 0; }
        .stars { color: #f39c12; font-size: 1.2rem; }
        .review-text { margin: 5px 0 0; }
        .review-date { font-size: 0.8rem; color: var(--sub-text); }
    </style>
</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">ğŸŒ™</button>

<div class="container">
    <h1>××” ×“×¢×ª×›× ×¢×œ ×”-Civic ×©×œ×™?</h1>
    <img src="car.jpg" alt="Honda Civic">

    <div class="stats-box">
        <p class="average-score" id="avgScore">0.0</p>
        <div class="stars" id="avgStars"></div>
        <p class="total-reviews" id="totalReviews">×˜×•×¢×Ÿ × ×ª×•× ×™×...</p>
    </div>

    <div class="rating-input">
        <label>×‘×—×¨ ×“×™×¨×•×’:</label>
        <select id="carRating">
            <option value="5">â­â­â­â­â­ (××¢×•×œ×”)</option>
            <option value="4">â­â­â­â­ (×˜×•×‘ ×××“)</option>
            <option value="3">â­â­â­ (× ×—××“)</option>
            <option value="2">â­â­ (×˜×¢×•×Ÿ ×©×™×¤×•×¨)</option>
            <option value="1">â­ (×œ× ××”×‘×ª×™)</option>
        </select>
        <textarea id="carComment" placeholder="×›×ª×‘×• ×—×•×•×ª ×“×¢×ª ×§×¦×¨×”..."></textarea>
        <button onclick="submitReview()">×©×œ×— ×“×™×¨×•×’</button>
    </div>

    <hr>
    <h3>×—×•×•×ª ×“×¢×ª ××”×’×•×œ×©×™×:</h3>
    <div id="reviews">×˜×•×¢×Ÿ ×—×•×•×ª ×“×¢×ª...</div>
</div>

<script type="module">
  // ×©×™××•×© ×‘-SDK ×©×œ Realtime Database
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCiBOPWWSgKlz0IHVvTt4jktfHLI1hsYQc",
    authDomain: "mycivic-11af8.firebaseapp.com",
    databaseURL: "https://mycivic-11af8-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "mycivic-11af8",
    storageBucket: "mycivic-11af8.firebasestorage.app",
    messagingSenderId: "428340353040",
    appId: "1:428340353040:web:f6f9f9ce2c83c8ed195295"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const reviewsRef = ref(db, 'reviews');

  // ×œ×•×’×™×§×ª Dark Mode
  window.toggleTheme = () => {
      const currentTheme = document.documentElement.getAttribute("data-theme");
      const targetTheme = currentTheme === "dark" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", targetTheme);
      localStorage.setItem("theme", targetTheme);
      document.getElementById("themeBtn").innerText = targetTheme === "dark" ? "â˜€ï¸" : "ğŸŒ™";
  };

  const savedTheme = localStorage.getItem("theme") || "light";
  document.documentElement.setAttribute("data-theme", savedTheme);
  document.getElementById("themeBtn").innerText = savedTheme === "dark" ? "â˜€ï¸" : "ğŸŒ™";

  // ×©×œ×™×—×ª × ×ª×•× ×™× ×œ-Realtime Database
  window.submitReview = () => {
    const rating = document.getElementById('carRating').value;
    const comment = document.getElementById('carComment').value;
    if (comment.trim() === "") return alert("×‘×‘×§×©×” ×›×ª×‘×• ×—×•×•×ª ×“×¢×ª");

    push(reviewsRef, {
      rating: parseInt(rating),
      comment: comment,
      timestamp: Date.now()
    }).then(() => {
        document.getElementById('carComment').value = "";
        alert("×ª×•×“×”! ×”×“×™×¨×•×’ ×”×ª×§×‘×œ.");
    }).catch((error) => {
        console.error("Error:", error);
        alert("×©×’×™××” ×‘×©×œ×™×—×”. ×•×•×“× ×©×¤×ª×—×ª ××ª ×”-Rules ×‘-Firebase.");
    });
  };

  // ×”××–× ×” ×œ×©×™× ×•×™×™× ×‘×–××Ÿ ×××ª
  onValue(reviewsRef, (snapshot) => {
    const data = snapshot.val();
    const reviewsDiv = document.getElementById('reviews');
    reviewsDiv.innerHTML = "";
    
    if (!data) {
        document.getElementById('totalReviews').innerText = "×ª×”×™×• ×”×¨××©×•× ×™× ×œ×“×¨×’!";
        return;
    }

    let totalScore = 0, count = 0;
    // ×”×¤×™×›×ª ×”××•×‘×™×™×§×˜ ×œ××¢×¨×š ×•×¡×™×“×•×¨ ×œ×¤×™ ×–××Ÿ (×—×“×© ×œ××¢×œ×”)
    const reviewsArray = Object.values(data).reverse();

    reviewsArray.forEach(review => {
      totalScore += review.rating;
      count++;
      const date = new Date(review.timestamp).toLocaleDateString('he-IL');
      reviewsDiv.innerHTML += `
        <div class="review-card">
            <div class="stars">${"â­".repeat(review.rating)}</div>
            <p class="review-text">${review.comment}</p>
            <span class="review-date">${date}</span>
        </div>
      `;
    });

    const avg = (totalScore / count).toFixed(1);
    document.getElementById('avgScore').innerText = avg;
    document.getElementById('avgStars').innerText = "â­".repeat(Math.round(avg));
    document.getElementById('totalReviews').innerText = `××‘×•×¡×¡ ×¢×œ ${count} ×“×™×¨×•×’×™×`;
  });
</script>

</body>
</html>
