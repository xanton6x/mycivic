<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×“×¨×’×• ××ª ×”-Civic ×©×œ×™</title>
    <style>
        :root {
            --bg-color: #f0f2f5; --card-bg: #ffffff; --text-color: #1c1e21;
            --sub-text: #65676b; --border-color: #ddd; --input-bg: #fff;
        }
        [data-theme="dark"] {
            --bg-color: #18191a; --card-bg: #242526; --text-color: #e4e6eb;
            --sub-text: #b0b3b8; --border-color: #3e4042; --input-bg: #3a3b3c;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); text-align: center; padding: 20px; color: var(--text-color); transition: 0.3s; }
        .container { max-width: 600px; margin: auto; background: var(--card-bg); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; }
        img { width: 100%; border-radius: 15px; margin-bottom: 20px; object-fit: cover; max-height: 400px; }
        .stats-box { background: var(--bg-color); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border-color); }
        .average-score { font-size: 2.5rem; font-weight: bold; color: #f39c12; margin: 0; }
        .rating-input { margin: 20px 0; background: var(--card-bg); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 10px; border: 1px solid var(--border-color); border-radius: 8px; box-sizing: border-box; background: var(--input-bg); color: var(--text-color); }
        button { background: #1877f2; color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; margin-top: 15px; font-weight: bold; width: 100%; }
        .theme-toggle, .admin-toggle { position: fixed; top: 20px; background: #1877f2; color: white; border: none; padding: 10px; border-radius: 50%; cursor: pointer; width: 45px; height: 45px; font-size: 20px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 1000; }
        .theme-toggle { left: 20px; }
        .admin-toggle { left: 75px; background: #42b72a; }
        #reviews { margin-top: 30px; text-align: right; }
        .review-card { border-bottom: 1px solid var(--border-color); padding: 15px 0; position: relative; }
        .stars { color: #f39c12; }
        .reviewer-name { font-weight: bold; display: block; margin-bottom: 5px; }
        .delete-btn { position: absolute; left: 0; top: 15px; background: #ff4d4d; color: white; border: none; border-radius: 5px; cursor: pointer; padding: 5px 10px; display: none; }
    </style>
</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">ğŸŒ™</button>
<button class="admin-toggle" onclick="adminLogin()" title="×›× ×™×¡×ª ×× ×”×œ">ğŸ”‘</button>

<div class="container">
    <h1>×“×™×¨×•×’ ×”-Civic ×©×œ×™</h1>
    <img src="car.jpg" alt="Honda Civic">

    <div class="stats-box">
        <p class="average-score" id="avgScore">0.0</p>
        <div id="avgStars"></div>
        <p id="totalReviews">×˜×•×¢×Ÿ × ×ª×•× ×™×...</p>
    </div>

    <div class="rating-input">
        <input type="text" id="reviewerName" placeholder="×”×©× ×©×œ×›×">
        <select id="carRating">
            <option value="5">â­â­â­â­â­ (××¢×•×œ×”)</option>
            <option value="4">â­â­â­â­ (×˜×•×‘ ×××“)</option>
            <option value="3">â­â­â­ (× ×—××“)</option>
            <option value="2">â­â­ (×˜×¢×•×Ÿ ×©×™×¤×•×¨)</option>
            <option value="1">â­ (×œ× ××”×‘×ª×™)</option>
        </select>
        <textarea id="carComment" placeholder="×›×ª×‘×• ×—×•×•×ª ×“×¢×ª..."></textarea>
        <button onclick="submitReview()">×©×œ×— ×“×™×¨×•×’</button>
    </div>

    <hr>
    <div id="reviews">×˜×•×¢×Ÿ ×—×•×•×ª ×“×¢×ª...</div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCiBOPWWSgKlz0IHVvTt4jktfHLI1hsYQc",
    authDomain: "mycivic-11af8.firebaseapp.com",
    databaseURL: "https://mycivic-11af8-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "mycivic-11af8",
    storageBucket: "mycivic-11af8.firebasestorage.app",
    messagingSenderId: "428340353040",
    appId: "1:428340353040:web:f6f9f9ce2c83c8ed195295"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const reviewsRef = ref(db, 'reviews');

  let isAdmin = false;

  // ×¤×•× ×§×¦×™×™×ª ×”×ª×—×‘×¨×•×ª ×× ×”×œ
  window.adminLogin = () => {
      const user = prompt("×©× ××©×ª××©:");
      const pass = prompt("×¡×™×¡××”:");
      if (user === "admin" && pass === "1234") {
          isAdmin = true;
          alert("××—×•×‘×¨ ×›×× ×”×œ! ×›×¤×ª×•×¨×™ ××—×™×§×” ×™×•×¤×™×¢×• ×›×¢×ª.");
          renderReviews(); // ×¨×¢× ×•×Ÿ ×”×ª×¦×•×’×” ×œ×”×¦×’×ª ×›×¤×ª×•×¨×™ ××—×™×§×”
      } else {
          alert("×¤×¨×˜×™× ×©×’×•×™×™×.");
      }
  };

  window.toggleTheme = () => {
      const target = document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", target);
      localStorage.setItem("theme", target);
      document.getElementById("themeBtn").innerText = target === "dark" ? "â˜€ï¸" : "ğŸŒ™";
  };

  window.submitReview = () => {
    const name = document.getElementById('reviewerName').value || "××•×¨×—";
    const rating = document.getElementById('carRating').value;
    const comment = document.getElementById('carComment').value;
    if (comment.trim() === "") return alert("×‘×‘×§×©×” ×›×ª×‘×• ×—×•×•×ª ×“×¢×ª");

    push(reviewsRef, {
      name: name,
      rating: parseInt(rating),
      comment: comment,
      timestamp: Date.now()
    }).then(() => {
        document.getElementById('carComment').value = "";
        document.getElementById('reviewerName').value = "";
    });
  };

  window.deleteReview = (id) => {
      if (confirm("×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×ª×’×•×‘×” ×–×•?")) {
          remove(ref(db, 'reviews/' + id));
      }
  };

  let currentData = {};
  onValue(reviewsRef, (snapshot) => {
    currentData = snapshot.val();
    renderReviews();
  });

  function renderReviews() {
    const reviewsDiv = document.getElementById('reviews');
    reviewsDiv.innerHTML = "<h3>×—×•×•×ª ×“×¢×ª:</h3>";
    if (!currentData) {
        document.getElementById('totalReviews').innerText = "×ª×”×™×• ×”×¨××©×•× ×™× ×œ×“×¨×’!";
        return;
    }

    let totalScore = 0, count = 0;
    // ×”×¤×™×›×ª ×”××•×‘×™×™×§×˜ ×œ××¢×¨×š ×¢× ×”-ID ×©×œ×•
    const sortedKeys = Object.keys(currentData).reverse();

    sortedKeys.forEach(id => {
      const review = currentData[id];
      totalScore += review.rating;
      count++;
      const date = new Date(review.timestamp).toLocaleDateString('he-IL');
      reviewsDiv.innerHTML += `
        <div class="review-card">
            ${isAdmin ? `<button class="delete-btn" style="display:block" onclick="deleteReview('${id}')">ğŸ—‘ï¸</button>` : ''}
            <span class="reviewer-name">${review.name}</span>
            <div class="stars">${"â­".repeat(review.rating)}</div>
            <p class="review-text">${review.comment}</p>
            <small style="color:var(--sub-text)">${date}</small>
        </div>
      `;
    });

    const avg = (totalScore / count).toFixed(1);
    document.getElementById('avgScore').innerText = avg;
    document.getElementById('avgStars').innerHTML = "â­".repeat(Math.round(avg));
    document.getElementById('totalReviews').innerText = `××‘×•×¡×¡ ×¢×œ ${count} ×“×™×¨×•×’×™×`;
  }

  // ×˜×¢×™× ×ª ×”×’×“×¨×ª ×¦×‘×¢×™×
  if (localStorage.getItem("theme") === "dark") {
      document.documentElement.setAttribute("data-theme", "dark");
      document.getElementById("themeBtn").innerText = "â˜€ï¸";
  }
</script>

</body>
</html>
